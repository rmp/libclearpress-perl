<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
 <head>
  <title>ClearPress Framework</title>
  <link rel="stylesheet" type="text/css" href="clearpress.css"/>
</head>

 <body>
  <h1>ClearPress Framework</h1>
<div class="main">

<h2>Working with Ajax</h2>

<p>
 If you're not sure
 what <a href="http://en.wikipedia.org/wiki/Ajax_(programming)">AJAX</a>
 is, in a nutshell it's the ability to load chunks of content
 behind-the-scenes using javascript. There are many, many other
 resources out there to tell you all about it, so I'm not going to
 attempt to do that here.
</p>

<p>
 Using AJAX with ClearPress is pretty simple but we'll begin at the
 beginning. Let's assume you have a regular, non-AJAX-view for
 displaying information for a car manufacturer:

<code>package app::view::manufacturer;
use strict;
use warnings;
use base qw(ClearPress::view);

1;</code>

 This will use the default ClearPress <i>read</i> method and look for
 the <i>manufacturer_read.tt2</i> template on disk when serving the
 <i>/manufacturer/1</i> URI (for manufacturer 1 of course, and
 assuming you have a corresponding model with some data).
</p>

<p>
 Luckily making use of the basic AJAX built-in to ClearPress is just
 as simple. The ClearPress view superclass contains support for
 read_ajax. What we'd like to do is display cars for that manufacturer
 without loading each page separately. We'll make another view class:

<code>package app::view::car;
use strict;
use warnings;
use base qw(ClearPress::view);

1;</code>

</p>

<p>
 We'll import the most
 excellent <a href="http://jquery.com/">jQuery</a> library to take
 care of making our requests for us.

 In data/config.ini:
<code>[general]
jsfile=http://code.jquery.com/jquery-1.4.1.min.js
</code>

and in the manufacturer_read.tt2 template we'll add this:

<code>&lt;ul&gt;
 [% FOREACH car = model.cars %]
  &lt;li&gt;
   &lt;a class="carlink" href="[% SCRIPT_NAME %]/car/[% car.id_car %]"&gt;
    [% car.name %]
   &lt;/a&gt;
  &lt;/li&gt;
 [% END %]
&lt;/ul&gt;
&lt;div id="cartarget"&gt;
&lt;/div&gt;

&lt;script type="text/javascript"&gt;
 $(document).ready(function(){
  $('a.carlink').click(function(){
   $('#cartarget').load(this.href);
   return false;
  }
 }
&lt;/script&gt;
</code>

</p>

<p>
 So what we're saying here is that when the document has finished
 loading, look for all anchors with a class of <i>carlink</i> and
 configure each so that when it's clicked it loads the anchor target
 into the <i>cartarget</i> div.
</p>

<p>
 The eagle-eyed among you may have spotted that
 the <i>/car/&lt;id&gt;</i> page will normally load with full header
 &amp; footer decoration but ClearPress is smart enough to detect the
 request is an AJAX one and serves the content without decoration.
</p>

<p>
 The following <b>static</b> example demonstrates what this achieves.
</p>

<iframe src="examples/ajax/manufacturer.shtml" style="width:500px;height:400px"></iframe>

</div><!--end main-->

<div id="menu">
 <ul>
  <li><a href="/index.shtml">About</a></li>
  <li><a href="/installing.shtml">Installing</a></li>
  <li><a href="/basics.shtml">The Basics</a></li>
  <li><a href="/rest.shtml">REST</a></li>
  <li><a href="/orm.shtml">ORM / Models</a></li>
  <li><a href="/views.shtml">Views</a></li>
  <li><a href="/routes.shtml">Routes</a></li>
  <li><a href="/streaming.shtml">Streamed content</a></li>
  <li><a href="/mimetypes.shtml">Custom response types</a></li>
  <li><a href="/paging.shtml">Paging Lists</a></li>
  <li><a href="/ajax.shtml">Working with AJAX</a></li>
  <li><a href="/authen.shtml">Authentication</a></li>
  <li><a href="/authz.shtml">Authorisation</a></li>
  <li><a href="/pdf.shtml">Exporting PDFs</a></li>
 </ul>

 <br/><br/><b>Still to come:</b>
 <ul style="font-style:italic">
  <li>Transactions</li>
  <li>Posting XML</li>
  <li>Automated Testing</li>
  <li>Internationalisation</li>
 </ul>
</div>


<div class="footer" style="margin-left:-50px">
<SCRIPT charset="utf-8" type="text/javascript" src="http://ws.amazon.co.uk/widgets/q?ServiceVersion=20070822&MarketPlace=GB&ID=V20070822/GB/gardmalt-21/8001/e9b44bbc-a251-45f1-8386-10affeb751cc"> </SCRIPT> <NOSCRIPT><A HREF="http://ws.amazon.co.uk/widgets/q?ServiceVersion=20070822&MarketPlace=GB&ID=V20070822%2FGB%2Fgardmalt-21%2F8001%2Fe9b44bbc-a251-45f1-8386-10affeb751cc&Operation=NoScript">Amazon.co.uk Widgets</A></NOSCRIPT>
</div>

<div class="footer">
<address><a href="mailto:rmp@psyphi.net">rmp</a></address>
<!-- Created: Mon Jan 19 11:45:21 GMT 2009 -->
<!-- hhmts start -->
Last modified: Tue Jan 26 12:12:00 2010
<!-- hhmts end -->
</div>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-815452-5");
pageTracker._trackPageview();
} catch(err) {}</script>
  </body>
</html>

